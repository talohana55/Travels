{"ast":null,"code":"import { FormControl, FormGroup, Validators } from \"@angular/forms\";\nimport { delay, finalize, forkJoin, map, shareReplay, startWith } from \"rxjs\";\nimport { first, tap } from \"rxjs\";\nimport * as moment from \"moment/moment\";\nimport { FadeIn } from \"../core/animations/animations\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/material/snack-bar\";\nimport * as i3 from \"../services/http.service\";\nimport * as i4 from \"@angular/material/datepicker\";\nimport * as i5 from \"ng-lazyload-image\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/material/autocomplete\";\nimport * as i8 from \"@angular/material/core\";\nimport * as i9 from \"@angular/material/form-field\";\nimport * as i10 from \"@angular/material/input\";\nimport * as i11 from \"@angular/material/slide-toggle\";\nimport * as i12 from \"@angular/material/button\";\nimport * as i13 from \"@angular/forms\";\nimport * as i14 from \"../flights/flights.component\";\n\nfunction HomeComponent_ng_container_0_div_1_mat_option_10_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelement(1, \"img\", 19);\n    i0.ɵɵelementStart(2, \"span\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const state_r12 = i0.ɵɵnextContext().$implicit;\n    const ctx_r13 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"lazyLoad\", state_r12.flag)(\"defaultImage\", ctx_r13.defaultImage);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"\", state_r12.cityName, \", \", state_r12.state, \"\");\n  }\n}\n\nfunction HomeComponent_ng_container_0_div_1_mat_option_10_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Anywhere\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction HomeComponent_ng_container_0_div_1_mat_option_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 16);\n    i0.ɵɵtemplate(1, HomeComponent_ng_container_0_div_1_mat_option_10_ng_container_1_Template, 4, 4, \"ng-container\", 17);\n    i0.ɵɵtemplate(2, HomeComponent_ng_container_0_div_1_mat_option_10_ng_template_2_Template, 2, 0, \"ng-template\", null, 18, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const state_r12 = ctx.$implicit;\n\n    const _r14 = i0.ɵɵreference(3);\n\n    i0.ɵɵproperty(\"value\", state_r12.cityName);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", state_r12.state !== \"anywhere\")(\"ngIfElse\", _r14);\n  }\n}\n\nfunction HomeComponent_ng_container_0_div_1_mat_option_18_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelement(1, \"img\", 19);\n    i0.ɵɵelementStart(2, \"span\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const state_r17 = i0.ɵɵnextContext().$implicit;\n    const ctx_r18 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"lazyLoad\", state_r17.flag)(\"defaultImage\", ctx_r18.defaultImage);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"\", state_r17.cityName, \", \", state_r17.state, \"\");\n  }\n}\n\nfunction HomeComponent_ng_container_0_div_1_mat_option_18_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Anywhere\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction HomeComponent_ng_container_0_div_1_mat_option_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 16);\n    i0.ɵɵtemplate(1, HomeComponent_ng_container_0_div_1_mat_option_18_ng_container_1_Template, 4, 4, \"ng-container\", 17);\n    i0.ɵɵtemplate(2, HomeComponent_ng_container_0_div_1_mat_option_18_ng_template_2_Template, 2, 0, \"ng-template\", null, 18, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const state_r17 = ctx.$implicit;\n\n    const _r19 = i0.ɵɵreference(3);\n\n    i0.ɵɵproperty(\"value\", state_r17.cityName);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", state_r17.state !== \"anywhere\")(\"ngIfElse\", _r19);\n  }\n}\n\nfunction HomeComponent_ng_container_0_div_1_mat_error_40_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Invalid start date\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction HomeComponent_ng_container_0_div_1_mat_error_41_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Invalid end date\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction HomeComponent_ng_container_0_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r23 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\")(1, \"h1\");\n    i0.ɵɵtext(2, \"Find your next vacation...\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 1)(4, \"mat-form-field\", 2)(5, \"mat-label\");\n    i0.ɵɵtext(6, \"From\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(7, \"input\", 3);\n    i0.ɵɵelementStart(8, \"mat-autocomplete\", null, 4);\n    i0.ɵɵtemplate(10, HomeComponent_ng_container_0_div_1_mat_option_10_Template, 4, 3, \"mat-option\", 5);\n    i0.ɵɵpipe(11, \"async\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"mat-form-field\", 2)(13, \"mat-label\");\n    i0.ɵɵtext(14, \"To\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(15, \"input\", 3);\n    i0.ɵɵelementStart(16, \"mat-autocomplete\", null, 6);\n    i0.ɵɵtemplate(18, HomeComponent_ng_container_0_div_1_mat_option_18_Template, 4, 3, \"mat-option\", 5);\n    i0.ɵɵpipe(19, \"async\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(20, \"div\", 1)(21, \"mat-form-field\", 7)(22, \"mat-label\");\n    i0.ɵɵtext(23, \"How many tickets do you need?\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(24, \"input\", 8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(25, \"mat-slide-toggle\", 9);\n    i0.ɵɵtext(26, \"Allow connection flights\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(27, \"mat-slide-toggle\", 9);\n    i0.ɵɵtext(28, \"Round trip (2 ways)\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(29, \"mat-form-field\", 2)(30, \"mat-label\");\n    i0.ɵɵtext(31, \"Enter a date range\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(32, \"mat-date-range-input\", 10);\n    i0.ɵɵelement(33, \"input\", 11)(34, \"input\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(35, \"mat-hint\");\n    i0.ɵɵtext(36, \"DD/MM/YYYY \\u2013 DD/MM/YYYY\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(37, \"mat-datepicker-toggle\", 13)(38, \"mat-date-range-picker\", null, 14);\n    i0.ɵɵtemplate(40, HomeComponent_ng_container_0_div_1_mat_error_40_Template, 2, 0, \"mat-error\", 0);\n    i0.ɵɵtemplate(41, HomeComponent_ng_container_0_div_1_mat_error_41_Template, 2, 0, \"mat-error\", 0);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(42, \"button\", 15);\n    i0.ɵɵlistener(\"click\", function HomeComponent_ng_container_0_div_1_Template_button_click_42_listener() {\n      i0.ɵɵrestoreView(_r23);\n      const ctx_r22 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r22.search());\n    });\n    i0.ɵɵtext(43, \" Search \");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const _r5 = i0.ɵɵreference(9);\n\n    const _r7 = i0.ɵɵreference(17);\n\n    const _r9 = i0.ɵɵreference(39);\n\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    let tmp_12_0;\n    let tmp_13_0;\n    i0.ɵɵproperty(\"@fadeIn\", undefined);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"matAutocomplete\", _r5)(\"formControl\", ctx_r4.fromStateCtrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(11, 16, ctx_r4.fromFilteredStates$));\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"matAutocomplete\", _r7)(\"formControl\", ctx_r4.toStateCtrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(19, 18, ctx_r4.toFilteredStates$));\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"formControl\", ctx_r4.ticketsCtrl);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formControl\", ctx_r4.connectionFlightCtrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"formControl\", ctx_r4.roundTripCtrl);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"formGroup\", ctx_r4.dateRange)(\"rangePicker\", _r9);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"for\", _r9);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", (tmp_12_0 = ctx_r4.dateRange.get(\"start\")) == null ? null : tmp_12_0.invalid);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", (tmp_13_0 = ctx_r4.dateRange.get(\"end\")) == null ? null : tmp_13_0.invalid);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", ctx_r4.formInvalid);\n  }\n}\n\nfunction HomeComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, HomeComponent_ng_container_0_div_1_Template, 44, 20, \"div\", 0);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.states && ctx_r0.dateRange && !(ctx_r0.results == null ? null : ctx_r0.results.length) && !(ctx_r0.connectionResultsMap == null ? null : ctx_r0.connectionResultsMap.size));\n  }\n}\n\nfunction HomeComponent_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelement(1, \"img\", 20);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"lazyLoad\", \"assets/search.gif\");\n  }\n}\n\nfunction HomeComponent_ng_container_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelement(1, \"app-flights\", 21);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    let tmp_1_0;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"flights\", ctx_r2.results)(\"tickets\", (tmp_1_0 = ctx_r2.ticketsCtrl.value) !== null && tmp_1_0 !== undefined ? tmp_1_0 : 0);\n  }\n}\n\nfunction HomeComponent_ng_container_3_ng_container_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r27 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"h1\", 24);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"app-flights\", 25);\n    i0.ɵɵelementStart(4, \"div\", 26)(5, \"p\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"p\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"button\", 27);\n    i0.ɵɵlistener(\"click\", function HomeComponent_ng_container_3_ng_container_2_Template_button_click_9_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r27);\n      const entry_r25 = restoredCtx.$implicit;\n      const ctx_r26 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r26.book(entry_r25.value));\n    });\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"currency\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const entry_r25 = ctx.$implicit;\n    const ctx_r24 = i0.ɵɵnextContext(2);\n    let tmp_2_0;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Option #\", entry_r25.key + 1, \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"flights\", entry_r25.value)(\"tickets\", (tmp_2_0 = ctx_r24.ticketsCtrl.value) !== null && tmp_2_0 !== undefined ? tmp_2_0 : 0)(\"disableBooking\", true)(\"disableFilter\", true)(\"disablePagination\", true)(\"disableAddNewFlight\", true);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Total Duration: \", ctx_r24.getTotalDuration(entry_r25.value), \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Total Distance: \", ctx_r24.getTotalDistance(entry_r25.value), \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" Book now for \", i0.ɵɵpipeBind2(11, 10, ctx_r24.getTotalPrice(entry_r25.value), \"USD\"), \" \");\n  }\n}\n\nfunction HomeComponent_ng_container_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 22);\n    i0.ɵɵtemplate(2, HomeComponent_ng_container_3_ng_container_2_Template, 12, 13, \"ng-container\", 23);\n    i0.ɵɵpipe(3, \"keyvalue\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(3, 1, ctx_r3.connectionResultsMap));\n  }\n}\n\nexport let HomeComponent = /*#__PURE__*/(() => {\n  class HomeComponent {\n    constructor(router, snackBar, httpService) {\n      this.router = router;\n      this.snackBar = snackBar;\n      this.httpService = httpService;\n      this.defaultImage = \"assets/logo.png\";\n      this.states = [];\n      this.results = [];\n      this.travelRoutes = [];\n      this.searching = false;\n      this.ticketsCtrl = new FormControl(2, [Validators.required, Validators.min(1), Validators.max(100)]);\n      this.connectionFlightCtrl = new FormControl(false);\n      this.roundTripCtrl = new FormControl(false);\n      this.fromStateCtrl = new FormControl(\"\", [Validators.required]);\n      this.toStateCtrl = new FormControl(\"\", [Validators.required]);\n    }\n\n    ngOnInit() {\n      this.httpService.getTravelRoutes().pipe(first(), tap(res => this.travelRoutes = res)).subscribe();\n      this.httpService.getState().pipe(first(), tap(states => this.states = [this.flexibleState, ...states]), tap(() => this.initForm()), shareReplay()).subscribe();\n    }\n\n    get formInvalid() {\n      return this.fromStateCtrl?.invalid || this.toStateCtrl?.invalid || this.dateRange?.invalid || this.ticketsCtrl?.invalid;\n    }\n\n    get flexibleState() {\n      return {\n        cid: \"anywhere\",\n        cityName: \"anywhere\",\n        flag: \"anywhere\",\n        state: \"anywhere\"\n      };\n    }\n\n    search() {\n      this.results = [];\n      this.searching = true;\n      const startDate = moment(this.dateRange.value.start).startOf(\"day\").toDate().getTime();\n      const endDate = moment(this.dateRange.value.end).startOf(\"day\").toDate().getTime();\n\n      if (this.connectionFlightCtrl.value) {\n        this.connectionFlightsStream(startDate, endDate, this.roundTripCtrl.value ?? false);\n      } else {\n        if (this.roundTripCtrl.value) {\n          forkJoin([this.httpService.searchFlights(\"\" + this.fromStateCtrl.value, \"\" + this.toStateCtrl.value, \"\" + startDate, \"\" + endDate), this.httpService.searchFlights(\"\" + this.toStateCtrl.value, \"\" + this.fromStateCtrl.value, \"\" + startDate, \"\")]).pipe(delay(3000), first(), map(results => results.reduce((all, itm) => all.concat(itm), [])), tap(res => this.setSearchResults(res)), finalize(() => this.searching = false)).subscribe();\n        } else {\n          this.httpService.searchFlights(\"\" + this.fromStateCtrl.value, \"\" + this.toStateCtrl.value, \"\" + startDate, \"\" + endDate).pipe(delay(3000), first(), tap(res => this.setSearchResults(res)), finalize(() => this.searching = false)).subscribe();\n        }\n      }\n    }\n\n    connectionFlightsStream(startDate, endDate, roundTrip) {\n      let forkArr = [];\n\n      if (\"\" + this.fromStateCtrl.value === \"anywhere\" && \"\" + this.toStateCtrl.value === \"anywhere\") {\n        forkArr = [this.httpService.searchFlights(\"\" + this.fromStateCtrl.value, \"\" + this.toStateCtrl.value, \"\" + startDate, \"\" + endDate)];\n      } else {\n        forkArr = [this.httpService.searchFlights(\"\" + this.fromStateCtrl.value, \"\" + this.toStateCtrl.value, \"\" + startDate, \"\" + endDate), this.httpService.searchFlights(\"\" + this.fromStateCtrl.value, \"anywhere\", \"\" + startDate, \"\" + endDate), this.httpService.searchFlights(\"anywhere\", \"\" + this.toStateCtrl.value, \"\" + startDate, \"\" + endDate)];\n      }\n\n      if (roundTrip) {\n        if (\"\" + this.fromStateCtrl.value === \"anywhere\" && \"\" + this.toStateCtrl.value === \"anywhere\") {\n          forkArr = forkArr.concat([this.httpService.searchFlights(\"\" + this.toStateCtrl.value, \"\" + this.fromStateCtrl.value, \"\" + startDate, \"\")]);\n        } else {\n          forkArr = forkArr.concat([this.httpService.searchFlights(\"\" + this.toStateCtrl.value, \"\" + this.fromStateCtrl.value, \"\" + startDate, \"\"), this.httpService.searchFlights(\"anywhere\", \"\" + this.fromStateCtrl.value, \"\" + startDate, \"\"), this.httpService.searchFlights(\"\" + this.toStateCtrl.value, \"anywhere\", \"\" + startDate, \"\")]);\n        }\n      }\n\n      forkJoin(forkArr).pipe(delay(3000), first(), map(results => results.reduce((all, itm) => all.concat(itm), [])), map(res => this.searchConnectionFlights(res, \"\" + this.fromStateCtrl.value, \"\" + this.toStateCtrl.value, roundTrip)), finalize(() => this.searching = false)).subscribe();\n    }\n\n    searchConnectionFlights(flights, from, to, roundTrip) {\n      let map = new Map(); // direct flights\n\n      const allFlights = flights.filter(f => {\n        if (from !== \"anywhere\" && to !== \"anywhere\") {\n          return f.departure === from && f.destination === to;\n        } else if (from === \"anywhere\" && to !== \"anywhere\") {\n          return f.destination === to;\n        } else if (from !== \"anywhere\" && to === \"anywhere\") {\n          return f.departure === from;\n        }\n\n        return f;\n      });\n\n      for (let f of allFlights) {\n        if (roundTrip) {\n          const fl = flights.filter(f => f.departure === to && f.destination === from);\n\n          for (let fr of fl) {\n            map.set(map.size + 1, [f, fr]);\n          }\n        } else {\n          map.set(map.size + 1, [f]);\n        }\n      }\n\n      if (allFlights && roundTrip && map.size === 0) {\n        for (let f of allFlights) {\n          if (!Array.from(map.values()).map(f => f[0].cid).includes(f.cid)) {\n            map.set(map.size + 1, [f]);\n          }\n        }\n      } // connection flights\n\n\n      const fromFlights = flights.filter(f => f.departure === from);\n\n      for (let f of fromFlights) {\n        const destenation = f.destination;\n        const possibleConnection = flights.filter(f => f.departure === destenation && f.destination === to);\n\n        for (let p of possibleConnection) {\n          if (roundTrip) {\n            const toOptions = flights.filter(f => f.departure === to);\n\n            for (let t of toOptions) {\n              const destenation = t.destination;\n              const pos = flights.filter(f => f.departure === destenation && f.destination === from);\n\n              for (let poo of pos) {\n                map.set(map.size + 1, [f, p, t, poo]);\n              }\n            }\n          } else {\n            map.set(map.size + 1, [f, p]);\n          }\n        }\n      }\n\n      map = this.filterMapResults(map);\n\n      if (!map?.size) {\n        this.showNoResultsSnackbar();\n      } else {\n        this.connectionResultsMap = map;\n      }\n    }\n\n    filterMapResults(map) {\n      let filterdMap = new Map();\n\n      for (let entry of map.entries()) {\n        let arr = entry[1];\n\n        if (arr.length > 4) {\n          continue;\n        }\n\n        let error = false;\n\n        for (let i = 0; i < arr.length - 1; i++) {\n          if (new Date(arr[i].arrival_datetime).getTime() >= new Date(arr[i + 1].departure_datetime).getTime()) {\n            error = true;\n            break;\n          } else if (i === 0 || i === 2) {\n            const start = moment(arr[i + 1].departure_datetime);\n            const end = moment(arr[i].arrival_datetime);\n            var duration = moment.duration(start.diff(end));\n            var hours = duration.asHours();\n\n            if (hours > 12) {\n              // to much time to wait between connection flights\n              error = true;\n              break;\n            }\n          }\n        }\n\n        if (error) {\n          continue;\n        } // check if tickets left\n\n\n        if (arr.every(f => f.max_capacity - f.current_capacity >= +(this.ticketsCtrl.value || 0))) {\n          filterdMap.set(filterdMap.size, entry[1]);\n        }\n      }\n\n      return filterdMap;\n    }\n\n    setSearchResults(res) {\n      this.results = res;\n\n      if (!res?.length) {\n        this.showNoResultsSnackbar();\n      }\n    }\n\n    showNoResultsSnackbar() {\n      this.snackBar.open(\"Sorry, we didn't find any flights for this search\", undefined, {\n        verticalPosition: \"top\",\n        duration: 3000\n      });\n    }\n\n    initForm() {\n      this.dateRange = new FormGroup({\n        start: new FormControl(null, [Validators.required]),\n        end: new FormControl(null, [Validators.required])\n      });\n      this.fromFilteredStates$ = this.fromStateCtrl.valueChanges.pipe(startWith(\"\"), map(state => state ? this._filterStates(state) : this.states.slice().sort((a, b) => a.cityName.localeCompare(b.cityName))));\n      this.toFilteredStates$ = this.toStateCtrl.valueChanges.pipe(startWith(\"\"), map(state => state ? this._filterStates(state) : this.states.slice().sort((a, b) => a.cityName.localeCompare(b.cityName))));\n    }\n\n    getTotalDuration(flights) {\n      let duration = 0;\n\n      for (let flight of flights) {\n        const travelRoute = this.travelRoutes?.find(t => t.from === flight.departure && t.to === flight.destination);\n\n        if (travelRoute) {\n          duration += +travelRoute.estimated_flight_time.split(\" \")[0];\n        }\n      }\n\n      return `${duration.toFixed(2)} hours`;\n    }\n\n    getTotalDistance(flights) {\n      let distance = 0;\n\n      for (let flight of flights) {\n        const travelRoute = this.travelRoutes?.find(t => t.from === flight.departure && t.to === flight.destination);\n\n        if (travelRoute) {\n          distance += +travelRoute.distance.split(\" \")[0];\n        }\n      }\n\n      return `${distance.toFixed(2)} km`;\n    }\n\n    getTotalPrice(flights) {\n      let total = 0;\n\n      for (let flight of flights) {\n        total += flight.price_per_ticket;\n      }\n\n      return total;\n    }\n\n    book(flights) {\n      sessionStorage.setItem(\"CHECKOUT_FLIGHTS\", JSON.stringify(flights));\n      sessionStorage.setItem(\"CHECKOUT_TICKETS\", JSON.stringify(this.ticketsCtrl.value));\n      this.router.navigate([\"checkout\"]);\n    }\n\n    _filterStates(value) {\n      const filterValue = value.toLowerCase();\n      return this.states.filter(state => {\n        const cityNameArr = state.cityName.replace(\"-\", \" \").split(\" \").filter(Boolean);\n        const countryArr = state.state.replace(\"-\", \" \").split(\" \").filter(Boolean);\n        return cityNameArr.map(n => n.toLowerCase()).some(n => filterValue.includes(n)) || countryArr.map(n => n.toLowerCase()).some(n => filterValue.includes(n));\n      }).sort((a, b) => a.cityName.localeCompare(b.cityName));\n    }\n\n  }\n\n  HomeComponent.ɵfac = function HomeComponent_Factory(t) {\n    return new (t || HomeComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.MatSnackBar), i0.ɵɵdirectiveInject(i3.HttpService));\n  };\n\n  HomeComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: HomeComponent,\n    selectors: [[\"app-home\"]],\n    decls: 4,\n    vars: 4,\n    consts: [[4, \"ngIf\"], [1, \"line\"], [\"appearance\", \"fill\"], [\"matInput\", \"\", \"aria-label\", \"State\", 3, \"matAutocomplete\", \"formControl\"], [\"autoFrom\", \"matAutocomplete\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"autoTo\", \"matAutocomplete\"], [\"appearance\", \"fill\", 1, \"tickets\"], [\"matInput\", \"\", \"type\", \"number\", 3, \"formControl\"], [\"color\", \"primary\", 3, \"formControl\"], [3, \"formGroup\", \"rangePicker\"], [\"matStartDate\", \"\", \"formControlName\", \"start\", \"placeholder\", \"Start date\"], [\"matEndDate\", \"\", \"formControlName\", \"end\", \"placeholder\", \"End date\"], [\"matIconSuffix\", \"\", 3, \"for\"], [\"picker\", \"\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 1, \"submit-btn\", 3, \"disabled\", \"click\"], [3, \"value\"], [4, \"ngIf\", \"ngIfElse\"], [\"anywhereTpl\", \"\"], [\"alt\", \"\", \"height\", \"25\", 1, \"option-img\", 3, \"lazyLoad\", \"defaultImage\"], [\"alt\", \"searching\", \"width\", \"254px\", 1, \"searching-animation\", 3, \"lazyLoad\"], [3, \"flights\", \"tickets\"], [1, \"connection-flight-options\"], [4, \"ngFor\", \"ngForOf\"], [1, \"connection-title\"], [1, \"connection\", 3, \"flights\", \"tickets\", \"disableBooking\", \"disableFilter\", \"disablePagination\", \"disableAddNewFlight\"], [1, \"connection-details\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 1, \"submit-btn\", 3, \"click\"]],\n    template: function HomeComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, HomeComponent_ng_container_0_Template, 2, 1, \"ng-container\", 0);\n        i0.ɵɵtemplate(1, HomeComponent_ng_container_1_Template, 2, 1, \"ng-container\", 0);\n        i0.ɵɵtemplate(2, HomeComponent_ng_container_2_Template, 2, 2, \"ng-container\", 0);\n        i0.ɵɵtemplate(3, HomeComponent_ng_container_3_Template, 4, 3, \"ng-container\", 0);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", !ctx.searching);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.searching);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.connectionFlightCtrl.value && (ctx.results == null ? null : ctx.results.length));\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.connectionFlightCtrl.value && (ctx.connectionResultsMap == null ? null : ctx.connectionResultsMap.size));\n      }\n    },\n    dependencies: [i4.MatDatepickerToggle, i4.MatDateRangeInput, i4.MatStartDate, i4.MatEndDate, i4.MatDateRangePicker, i5.LazyLoadImageDirective, i6.NgForOf, i6.NgIf, i7.MatAutocomplete, i7.MatAutocompleteTrigger, i8.MatOption, i9.MatError, i9.MatFormField, i9.MatHint, i9.MatLabel, i10.MatInput, i11.MatSlideToggle, i12.MatButton, i13.DefaultValueAccessor, i13.NumberValueAccessor, i13.NgControlStatus, i13.NgControlStatusGroup, i13.FormControlDirective, i13.FormGroupDirective, i13.FormControlName, i14.FlightsComponent, i6.AsyncPipe, i6.CurrencyPipe, i6.KeyValuePipe],\n    styles: [\"[_nghost-%COMP%]{min-height:calc(100vh - 128px);display:flex;flex-direction:column;justify-content:center;align-items:center;overflow-y:auto}mat-card-title[_ngcontent-%COMP%], mat-card-content[_ngcontent-%COMP%]{display:flex;justify-content:center}.form[_ngcontent-%COMP%]{min-width:150px;max-width:500px;width:100%}.full-width[_ngcontent-%COMP%]{width:100%}.option-img[_ngcontent-%COMP%]{vertical-align:middle;margin-right:8px}[dir=rtl][_ngcontent-%COMP%]   .option-img[_ngcontent-%COMP%]{margin-right:0;margin-left:8px}.line[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;align-items:baseline;gap:20px}.line[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{min-width:300px}.line[_ngcontent-%COMP%]   mat-form-field.tickets[_ngcontent-%COMP%]{min-width:200px}.submit-btn[_ngcontent-%COMP%]{margin-top:50px;width:100%;max-width:100%}.mat-form-field[_ngcontent-%COMP%]{display:block}.connection-flight-options[_ngcontent-%COMP%]{margin:60px auto 30px}.connection-details[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto auto;justify-content:center;align-items:center;gap:25px;margin:0 auto 20px}.connection-details[_ngcontent-%COMP%]   .submit-btn[_ngcontent-%COMP%]{grid-column:1/-1;width:-moz-fit-content;width:fit-content;margin:auto}.country-gallery[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,max-content);gap:0 10px;margin:30px!important}.country-img[_ngcontent-%COMP%]{object-fit:cover;width:100%;max-height:100%}\"],\n    data: {\n      animation: [FadeIn(200)]\n    }\n  });\n  return HomeComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}