{"ast":null,"code":"import { FormArray, FormControl, FormGroup, Validators } from \"@angular/forms\";\nimport { combineLatest, finalize, first, forkJoin, tap } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/material/snack-bar\";\nimport * as i3 from \"../services/http.service\";\nimport * as i4 from \"../app.auth.service\";\nimport * as i5 from \"ngx-paypal\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/material/form-field\";\nimport * as i8 from \"@angular/material/input\";\nimport * as i9 from \"@angular/material/radio\";\nimport * as i10 from \"@angular/material/slide-toggle\";\nimport * as i11 from \"@angular/material/card\";\nimport * as i12 from \"@angular/material/button\";\nimport * as i13 from \"@angular/material/icon\";\nimport * as i14 from \"@angular/material/tooltip\";\nimport * as i15 from \"@angular/forms\";\n\nconst _c0 = function (a0) {\n  return [a0];\n};\n\nfunction CartComponent_ng_container_0_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13)(1, \"div\", 14)(2, \"p\");\n    i0.ɵɵtext(3, \"Flight number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 15)(7, \"mat-icon\");\n    i0.ɵɵtext(8, \"flight_takeoff\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"span\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"span\", 16);\n    i0.ɵɵtext(12);\n    i0.ɵɵpipe(13, \"date\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(14, \"div\", 17)(15, \"mat-icon\");\n    i0.ɵɵtext(16, \"flight_land\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"span\");\n    i0.ɵɵtext(18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"span\", 16);\n    i0.ɵɵtext(20);\n    i0.ɵɵpipe(21, \"date\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(22, \"div\", 18)(23, \"mat-icon\");\n    i0.ɵɵtext(24, \"access_time\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(25, \"span\");\n    i0.ɵɵtext(26, \"Duration\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(27, \"span\", 16);\n    i0.ɵɵtext(28);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(29, \"div\", 19)(30, \"mat-icon\");\n    i0.ɵɵtext(31, \"gesture\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(32, \"span\");\n    i0.ɵɵtext(33, \"Distance\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(34, \"span\", 16);\n    i0.ɵɵtext(35);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(36, \"div\", 20)(37, \"mat-icon\");\n    i0.ɵɵtext(38, \"money\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(39, \"span\");\n    i0.ɵɵtext(40, \"Ticket Price\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(41, \"span\", 16);\n    i0.ɵɵtext(42);\n    i0.ɵɵpipe(43, \"currency\");\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const flight_r7 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(flight_r7.flight_num);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(flight_r7.departure);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(13, 8, flight_r7.departure_datetime, \"dd/MM/yyyy HH:mm\"));\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(flight_r7.destination);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(21, 11, flight_r7.arrival_datetime, \"dd/MM/yyyy HH:mm\"));\n    i0.ɵɵadvance(8);\n    i0.ɵɵtextInterpolate(ctx_r1.getTotalDuration(i0.ɵɵpureFunction1(17, _c0, flight_r7)));\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate(ctx_r1.getTotalDistance(i0.ɵɵpureFunction1(19, _c0, flight_r7)));\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(43, 14, flight_r7.price_per_ticket, \"USD\"));\n  }\n}\n\nfunction CartComponent_ng_container_0_mat_card_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-card\");\n    i0.ɵɵelementContainerStart(1, 21);\n    i0.ɵɵelementStart(2, \"mat-card-title\")(3, \"h4\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"mat-card-content\")(6, \"div\", 22)(7, \"mat-form-field\", 23)(8, \"mat-label\");\n    i0.ɵɵtext(9, \"Fullname\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(10, \"input\", 24);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"mat-form-field\", 23)(12, \"mat-label\");\n    i0.ɵɵtext(13, \"Email\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(14, \"input\", 25);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"mat-form-field\", 23)(16, \"mat-label\");\n    i0.ɵɵtext(17, \"Phone\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(18, \"input\", 26);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"mat-form-field\", 23)(20, \"mat-label\");\n    i0.ɵɵtext(21, \"Birthdate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(22, \"input\", 27);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"mat-form-field\", 23)(24, \"mat-label\");\n    i0.ɵɵtext(25, \"Nationality\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(26, \"input\", 28);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(27, \"mat-form-field\", 23)(28, \"mat-label\");\n    i0.ɵɵtext(29, \"Personal ID\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(30, \"input\", 29);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(31, \"mat-form-field\", 23)(32, \"mat-label\");\n    i0.ɵɵtext(33, \"Passport Number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(34, \"input\", 30);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const i_r9 = ctx.index;\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formGroup\", ctx_r2.getTicketFormGroup(i_r9));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Passenger #\", i_r9 + 1, \"\");\n  }\n}\n\nfunction CartComponent_ng_container_0_div_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 31)(1, \"div\")(2, \"mat-form-field\", 32)(3, \"mat-icon\", 33);\n    i0.ɵɵtext(4, \"payment\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"mat-label\");\n    i0.ɵɵtext(6, \"Card number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(7, \"input\", 34, 35);\n    i0.ɵɵelementStart(9, \"mat-hint\", 36);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(11, \"div\")(12, \"mat-form-field\", 37)(13, \"mat-icon\", 38);\n    i0.ɵɵtext(14, \"person_outline\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"mat-label\");\n    i0.ɵɵtext(16, \"Name on card\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(17, \"input\", 39);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(18, \"div\")(19, \"mat-form-field\", 40)(20, \"mat-label\");\n    i0.ɵɵtext(21, \"Month\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"select\", 41)(23, \"option\", 42);\n    i0.ɵɵtext(24, \"01\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(25, \"option\", 43);\n    i0.ɵɵtext(26, \"02\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(27, \"option\", 44);\n    i0.ɵɵtext(28, \"03\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"option\", 45);\n    i0.ɵɵtext(30, \"04\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(31, \"option\", 46);\n    i0.ɵɵtext(32, \"05\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(33, \"option\", 47);\n    i0.ɵɵtext(34, \"06\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(35, \"option\", 48);\n    i0.ɵɵtext(36, \"07\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(37, \"option\", 49);\n    i0.ɵɵtext(38, \"08\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(39, \"option\", 50);\n    i0.ɵɵtext(40, \"09\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(41, \"option\", 51);\n    i0.ɵɵtext(42, \"10\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(43, \"option\", 52);\n    i0.ɵɵtext(44, \"11\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(45, \"option\", 53);\n    i0.ɵɵtext(46, \"12\");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(47, \"div\")(48, \"mat-form-field\", 40)(49, \"mat-label\");\n    i0.ɵɵtext(50, \"Year\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(51, \"select\", 54)(52, \"option\", 55);\n    i0.ɵɵtext(53, \"2022\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(54, \"option\", 56);\n    i0.ɵɵtext(55, \"2023\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(56, \"option\", 57);\n    i0.ɵɵtext(57, \"2024\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(58, \"option\", 58);\n    i0.ɵɵtext(59, \"2025\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(60, \"option\", 59);\n    i0.ɵɵtext(61, \"2026\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(62, \"option\", 60);\n    i0.ɵɵtext(63, \"2027\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(64, \"option\", 61);\n    i0.ɵɵtext(65, \"2028\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(66, \"option\", 62);\n    i0.ɵɵtext(67, \"2029\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(68, \"option\", 63);\n    i0.ɵɵtext(69, \"2030\");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(70, \"div\")(71, \"mat-form-field\", 64)(72, \"mat-icon\", 65);\n    i0.ɵɵtext(73, \" help_outline\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(74, \"mat-label\");\n    i0.ɵɵtext(75, \"CVV\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(76, \"input\", 66);\n    i0.ɵɵelementStart(77, \"mat-hint\");\n    i0.ɵɵtext(78, \"Behind your card\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(79, \"div\")(80, \"mat-slide-toggle\", 67);\n    i0.ɵɵtext(81, \"Save my credit card details for future orders\");\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const _r10 = i0.ɵɵreference(8);\n\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"formGroup\", ctx_r4.creditCardDetails);\n    i0.ɵɵadvance(10);\n    i0.ɵɵtextInterpolate1(\"\", (_r10 == null ? null : _r10.value == null ? null : _r10.value.length) || 0, \"/16\");\n  }\n}\n\nfunction CartComponent_ng_container_0_div_30_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 68);\n    i0.ɵɵelement(1, \"ngx-paypal\", 69);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"config\", ctx_r5.payPalConfig);\n  }\n}\n\nfunction CartComponent_ng_container_0_mat_card_actions_31_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"mat-card-actions\");\n    i0.ɵɵelement(1, \"span\", 70);\n    i0.ɵɵelementStart(2, \"button\", 71);\n    i0.ɵɵlistener(\"click\", function CartComponent_ng_container_0_mat_card_actions_31_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r11 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r11.onSubmit());\n    });\n    i0.ɵɵtext(3);\n    i0.ɵɵpipe(4, \"currency\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", !ctx_r6.isFormValid());\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Pay \", i0.ɵɵpipeBind2(4, 2, ctx_r6.getTotalPrice(ctx_r6.flights), \"USD\"), \" \");\n  }\n}\n\nfunction CartComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"mat-card\")(2, \"mat-card-title\")(3, \"h4\");\n    i0.ɵɵtext(4, \"Your flight summary\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"mat-card-content\");\n    i0.ɵɵtemplate(6, CartComponent_ng_container_0_div_6_Template, 44, 21, \"div\", 1);\n    i0.ɵɵelementStart(7, \"div\", 2)(8, \"p\");\n    i0.ɵɵtext(9, \"Total price for \");\n    i0.ɵɵelementStart(10, \"mat-icon\");\n    i0.ɵɵtext(11, \"loyalty\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"p\");\n    i0.ɵɵtext(14);\n    i0.ɵɵpipe(15, \"currency\");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵtemplate(16, CartComponent_ng_container_0_mat_card_16_Template, 35, 2, \"mat-card\", 3);\n    i0.ɵɵelementStart(17, \"mat-card\")(18, \"mat-card-title\")(19, \"h4\");\n    i0.ɵɵtext(20, \"Payment method\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(21, \"mat-card-content\")(22, \"div\", 4)(23, \"mat-radio-group\", 5)(24, \"mat-radio-button\", 6, 7);\n    i0.ɵɵelement(26, \"img\", 8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(27, \"mat-radio-button\", 9);\n    i0.ɵɵelement(28, \"img\", 10);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵtemplate(29, CartComponent_ng_container_0_div_29_Template, 82, 2, \"div\", 11);\n    i0.ɵɵtemplate(30, CartComponent_ng_container_0_div_30_Template, 2, 1, \"div\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(31, CartComponent_ng_container_0_mat_card_actions_31_Template, 5, 5, \"mat-card-actions\", 0);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const _r3 = i0.ɵɵreference(25);\n\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.flights);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.ticketsNumber, \" tickets:\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(15, 9, ctx_r0.getTotalPrice(ctx_r0.flights), \"USD\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.ticketArray == null ? null : ctx_r0.ticketArray.controls);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"formControl\", ctx_r0.paymentMethodCtrl)(\"selected\", _r3);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngIf\", (ctx_r0.paymentMethodCtrl == null ? null : ctx_r0.paymentMethodCtrl.value) === \"visa\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", (ctx_r0.paymentMethodCtrl == null ? null : ctx_r0.paymentMethodCtrl.value) === \"paypal\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", (ctx_r0.paymentMethodCtrl == null ? null : ctx_r0.paymentMethodCtrl.value) === \"visa\");\n  }\n}\n\nexport let CartComponent = /*#__PURE__*/(() => {\n  class CartComponent {\n    constructor(router, snackBar, httpService, authService) {\n      this.router = router;\n      this.snackBar = snackBar;\n      this.httpService = httpService;\n      this.authService = authService;\n      this.travelRoutes = [];\n      this.tickets = new FormArray([]);\n      this.paymentMethodCtrl = new FormControl(\"visa\");\n    }\n\n    ngOnInit() {\n      this.initPaymentMethods();\n      const flightsFromSession = sessionStorage.getItem(\"CHECKOUT_FLIGHTS\");\n      const ticketsFromSession = sessionStorage.getItem(\"CHECKOUT_TICKETS\");\n\n      if (flightsFromSession && ticketsFromSession) {\n        this.flights = JSON.parse(flightsFromSession);\n        this.ticketsNumber = JSON.parse(ticketsFromSession);\n        combineLatest([this.authService.loggedInUser$, this.httpService.getTravelRoutes()]).pipe(first(), tap(res => this.loggedInUser = res[0]), tap(res => this.travelRoutes = res[1]), tap(() => this.createForm())).subscribe();\n      }\n    }\n\n    initPaymentMethods() {\n      this.initPaypalConfig();\n      this.creditCardDetails = new FormGroup({\n        cardNumber: new FormControl(\"\", [Validators.required, Validators.minLength(16)]),\n        cardExpirationMonth: new FormControl(\"\", [Validators.required, Validators.min(1), Validators.max(12)]),\n        cardExpirationYear: new FormControl(\"\", [Validators.required, Validators.min(new Date().getFullYear())]),\n        cardCvv: new FormControl(\"\", [Validators.required, Validators.minLength(3), Validators.maxLength(4)]),\n        storeCreditDetails: new FormControl(true, Validators.required)\n      });\n    }\n\n    createForm() {\n      for (let i = 0; i < this.ticketsNumber; i++) {\n        let formGroup = new FormGroup({\n          userFullname: new FormControl({\n            value: i === 0 ? this.loggedInUser.name : \"\",\n            disabled: i === 0\n          }, Validators.required),\n          userEmail: new FormControl({\n            value: i === 0 ? this.loggedInUser.email : \"\",\n            disabled: i === 0\n          }, Validators.required),\n          userPhone: new FormControl({\n            value: i === 0 ? this.loggedInUser.phone : \"\",\n            disabled: i === 0\n          }, Validators.required),\n          birthdate: new FormControl(\"\", Validators.required),\n          nationality: new FormControl(\"\", Validators.required),\n          userId: new FormControl(\"\", [Validators.required, Validators.pattern(\"^[0-9]*$\"), Validators.minLength(9), Validators.maxLength(9)]),\n          passportNumber: new FormControl(\"\", [Validators.required, Validators.pattern(\"^[0-9]*$\"), Validators.minLength(9), Validators.maxLength(9)])\n        });\n        this.tickets.push(formGroup);\n      }\n    }\n\n    get ticketArray() {\n      return this.tickets;\n    }\n\n    getTicketFormGroup(index) {\n      return this.ticketArray.controls[index];\n    }\n\n    getTotalDuration(flights) {\n      let duration = 0;\n\n      for (let flight of flights) {\n        const travelRoute = this.travelRoutes?.find(t => t.from === flight.departure && t.to === flight.destination);\n\n        if (travelRoute) {\n          duration += +travelRoute.estimated_flight_time.split(\" \")[0];\n        }\n      }\n\n      return `${duration.toFixed(2)} hours`;\n    }\n\n    getTotalDistance(flights) {\n      let distance = 0;\n\n      for (let flight of flights) {\n        const travelRoute = this.travelRoutes?.find(t => t.from === flight.departure && t.to === flight.destination);\n\n        if (travelRoute) {\n          distance += +travelRoute.distance.split(\" \")[0];\n        }\n      }\n\n      return `${distance.toFixed(2)} km`;\n    }\n\n    getTotalPrice(flights) {\n      let total = 0;\n\n      for (let flight of flights) {\n        total += flight.price_per_ticket;\n      }\n\n      return total * (this.ticketsNumber ?? 1);\n    }\n\n    isFormValid() {\n      return this.tickets?.valid && this.creditCardDetails.valid;\n    }\n\n    onSubmit() {\n      if (this.isFormValid()) {\n        this.httpService.createOrder({\n          userId: this.loggedInUser.email,\n          ...this.creditCardDetails.value\n        }).pipe(first(), tap(res => this.updateFlightsAfterPurchase(res))).subscribe();\n      }\n    }\n\n    updateFlightsAfterPurchase(order) {\n      // go to each flight and change the current_capacity number to plus this.ticketsNumber\n      let httpArr = [];\n\n      for (let flight of this.flights) {\n        httpArr.push(this.httpService.updateFlight({ ...flight,\n          current_capacity: flight.current_capacity + this.ticketsNumber\n        }));\n      }\n\n      forkJoin(httpArr).pipe(first(), finalize(() => this.router.navigate([\"home\"]).then(() => {\n        this.snackBar.open(`Thank you! your order number is: ${order._id}, see you soon!`, undefined, {\n          verticalPosition: \"top\",\n          duration: 3000\n        });\n        sessionStorage.clear();\n      }))).subscribe();\n    }\n\n    initPaypalConfig() {\n      this.payPalConfig = {\n        currency: \"USD\",\n        clientId: \"sb\",\n        createOrderOnClient: data => ({\n          intent: \"CAPTURE\",\n          purchase_units: [{\n            amount: {\n              currency_code: \"USD\",\n              value: \"\" + this.getTotalPrice(this.flights),\n              breakdown: {\n                item_total: {\n                  currency_code: \"USD\",\n                  value: \"\" + this.getTotalPrice(this.flights)\n                }\n              }\n            },\n            items: [{\n              name: \"Flight tickets\",\n              quantity: \"1\",\n              category: \"DIGITAL_GOODS\",\n              unit_amount: {\n                currency_code: \"USD\",\n                value: \"\" + this.getTotalPrice(this.flights)\n              }\n            }]\n          }]\n        }),\n        advanced: {\n          commit: \"true\"\n        },\n        style: {\n          label: \"pay\",\n          layout: \"horizontal\",\n          fundingicons: true,\n          shape: \"pill\"\n        },\n        onApprove: (data, actions) => {\n          console.log(\"onApprove - transaction was approved, but not authorized\", data, actions);\n          actions.order.get().then(details => {\n            console.log(\"onApprove - you can get full order details inside onApprove: \", details);\n          });\n        },\n        onClientAuthorization: data => {\n          console.log(\"onClientAuthorization - you should probably inform your server about completed transaction at this point\", data);\n        },\n        onCancel: (data, actions) => {\n          console.log(\"OnCancel\", data, actions);\n        },\n        onError: err => {\n          console.log(\"OnError\", err);\n        },\n        onClick: (data, actions) => {\n          console.log(\"onClick\", data, actions);\n        }\n      };\n    }\n\n  }\n\n  CartComponent.ɵfac = function CartComponent_Factory(t) {\n    return new (t || CartComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.MatSnackBar), i0.ɵɵdirectiveInject(i3.HttpService), i0.ɵɵdirectiveInject(i4.AuthService));\n  };\n\n  CartComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CartComponent,\n    selectors: [[\"app-cart\"]],\n    decls: 1,\n    vars: 1,\n    consts: [[4, \"ngIf\"], [\"class\", \"flight-box\", 4, \"ngFor\", \"ngForOf\"], [1, \"flight-totals\"], [4, \"ngFor\", \"ngForOf\"], [1, \"payment-type-container\"], [\"color\", \"primary\", \"aria-label\", \"Select an option\", 3, \"formControl\", \"selected\"], [\"value\", \"visa\"], [\"visa\", \"\"], [\"src\", \"https://res.cloudinary.com/ffdc/image/upload/v1593768892/cards_logos_drnu5h.png\", 1, \"payment-logo\"], [\"value\", \"paypal\"], [\"src\", \"https://res.cloudinary.com/ffdc/image/upload/v1593768982/paypal_logo_st1m41.png\", 1, \"payment-logo\"], [\"class\", \"card-form-container\", 3, \"formGroup\", 4, \"ngIf\"], [\"class\", \"card-form-container\", 4, \"ngIf\"], [1, \"flight-box\"], [1, \"flight-num\"], [1, \"flight-from\"], [1, \"flight-datetime\"], [1, \"flight-to\"], [1, \"flight-duration\"], [1, \"flight-distance\"], [1, \"flight-price\"], [3, \"formGroup\"], [1, \"form\", \"tickets-form\"], [1, \"form-element\"], [\"matInput\", \"\", \"formControlName\", \"userFullname\"], [\"matInput\", \"\", \"formControlName\", \"userEmail\"], [\"matInput\", \"\", \"formControlName\", \"userPhone\"], [\"type\", \"datetime-local\", \"matInput\", \"\", \"formControlName\", \"birthdate\"], [\"matInput\", \"\", \"formControlName\", \"nationality\"], [\"type\", \"text\", \"matInput\", \"\", \"formControlName\", \"userId\"], [\"type\", \"text\", \"matInput\", \"\", \"formControlName\", \"passportNumber\"], [1, \"card-form-container\", 3, \"formGroup\"], [\"appearance\", \"fill\", \"dense\", \"\", 1, \"example-full-width\"], [\"matPrefix\", \"\", \"dense\", \"\", \"color\", \"primary\", 1, \"card-details-icon\"], [\"matInput\", \"\", \"maxlength\", \"16\", \"placeholder\", \"0000-0000-0000-0000\", \"formControlName\", \"cardNumber\"], [\"input\", \"\"], [\"align\", \"end\"], [\"floatLabel\", \"never\", \"dense\", \"\", \"appearance\", \"fill\", 1, \"example-full-width\"], [\"color\", \"primary\", \"dense\", \"\", \"matPrefix\", \"\", 1, \"card-details-icon\"], [\"type\", \"text\", \"matInput\", \"\", \"placeholder\", \"John Doe\"], [\"dense\", \"\", 1, \"expire-month\"], [\"matNativeControl\", \"\", \"formControlName\", \"cardExpirationMonth\"], [\"value\", \"january\"], [\"value\", \"february\"], [\"value\", \"march\"], [\"value\", \"april\"], [\"value\", \"may\"], [\"value\", \"june\"], [\"value\", \"july\"], [\"value\", \"august\"], [\"value\", \"september\"], [\"value\", \"october\"], [\"value\", \"november\"], [\"value\", \"december\"], [\"matNativeControl\", \"\", \"formControlName\", \"cardExpirationYear\"], [\"value\", \"2022\"], [\"value\", \"2023\"], [\"value\", \"2024\"], [\"value\", \"2025\"], [\"value\", \"2026\"], [\"value\", \"2027\"], [\"value\", \"2028\"], [\"value\", \"2029\"], [\"value\", \"2030\"], [\"dense\", \"\", \"appearance\", \"fill\"], [\"color\", \"primary\", \"matSuffix\", \"\", \"dense\", \"\", \"matTooltip\", \"The 3 digits at the back of your card\"], [\"type\", \"text\", \"matInput\", \"\", \"placeholder\", \"000\", \"formControlName\", \"cardCvv\"], [\"color\", \"primary\", \"formControlName\", \"storeCreditDetails\"], [1, \"card-form-container\"], [3, \"config\"], [1, \"fill-remaining-space\"], [\"mat-flat-button\", \"\", \"color\", \"primary\", 3, \"disabled\", \"click\"]],\n    template: function CartComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, CartComponent_ng_container_0_Template, 32, 12, \"ng-container\", 0);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.ticketArray);\n      }\n    },\n    dependencies: [i5.NgxPaypalComponent, i6.NgForOf, i6.NgIf, i7.MatFormField, i7.MatHint, i7.MatLabel, i7.MatPrefix, i7.MatSuffix, i8.MatInput, i9.MatRadioGroup, i9.MatRadioButton, i10.MatSlideToggle, i11.MatCard, i11.MatCardContent, i11.MatCardTitle, i11.MatCardActions, i12.MatButton, i13.MatIcon, i14.MatTooltip, i15.NgSelectOption, i15.ɵNgSelectMultipleOption, i15.DefaultValueAccessor, i15.SelectControlValueAccessor, i15.NgControlStatus, i15.NgControlStatusGroup, i15.MaxLengthValidator, i15.FormControlDirective, i15.FormGroupDirective, i15.FormControlName, i6.CurrencyPipe, i6.DatePipe],\n    styles: [\"[_nghost-%COMP%]{min-height:calc(100vh - 128px);display:flex;flex-flow:column;justify-content:flex-start;align-items:center;overflow-y:auto;gap:30px}.mat-card-title[_ngcontent-%COMP%]{margin-bottom:30px;border-bottom:1px solid silver;text-transform:uppercase}.mat-card[_ngcontent-%COMP%]{width:85vw;padding:40px;min-width:700px;display:block}.mat-card[_ngcontent-%COMP%]:first-of-type{margin-top:50px}.mat-card[_ngcontent-%COMP%]:last-of-type{margin-bottom:50px}.mat-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-weight:700;font-size:20px;color:#673ab7}.mat-card[_ngcontent-%COMP%]   .payment-type-container[_ngcontent-%COMP%]   .payment-logo[_ngcontent-%COMP%]{width:90px;vertical-align:sub;margin-right:30px}.mat-card[_ngcontent-%COMP%]   .mat-card-content[_ngcontent-%COMP%]   .card-form-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;flex-wrap:wrap;align-items:center;gap:30px;margin-top:20px}.mat-card[_ngcontent-%COMP%]   .expire-month[_ngcontent-%COMP%]{width:90px}.flight-box[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(6,1fr);gap:20px;padding-bottom:20px;margin-bottom:20px;border-bottom:1px solid #e9e9e9}.flight-box[_ngcontent-%COMP%]   .flight-num[_ngcontent-%COMP%]{display:grid;row-gap:0;text-align:left;font-weight:700;font-size:16px;align-items:center;justify-content:center}.flight-box[_ngcontent-%COMP%]   .flight-num[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.flight-box[_ngcontent-%COMP%]   .flight-from[_ngcontent-%COMP%], .flight-box[_ngcontent-%COMP%]   .flight-to[_ngcontent-%COMP%], .flight-box[_ngcontent-%COMP%]   .flight-duration[_ngcontent-%COMP%], .flight-box[_ngcontent-%COMP%]   .flight-distance[_ngcontent-%COMP%], .flight-box[_ngcontent-%COMP%]   .flight-price[_ngcontent-%COMP%]{display:grid;grid-template-columns:20px auto;row-gap:0;text-align:left;font-weight:700;font-size:16px;align-items:center;justify-content:center;column-gap:15px}.flight-box[_ngcontent-%COMP%]   .flight-datetime[_ngcontent-%COMP%]{font-size:15px;grid-column:1/-1;font-weight:700;text-align:center;color:#6c6c6c}.flight-totals[_ngcontent-%COMP%]{background:rgba(233,233,233,.4);padding:20px;font-weight:700;font-size:18px;display:flex;justify-content:flex-end;align-items:center;gap:20px}.flight-totals[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;display:flex;justify-content:center;align-items:center;gap:2px}.flight-totals[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:last-of-type{font-size:25px;align-self:flex-start}.tickets-form[_ngcontent-%COMP%]{display:flex;flex-flow:row;flex-wrap:wrap;column-gap:30px}.card-details-icon[_ngcontent-%COMP%]{position:relative;top:5px}\"]\n  });\n  return CartComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}